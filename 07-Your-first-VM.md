# Your first VM

To create a VM, we will be declaring a terraform resource of type **openstack_compute_instance_v2**.

```terraform
resource "openstack_compute_instance_v2" "workshop_worker" {
  name        = "${terraform.workspace}-workshop_worker"
  image_id    = "{{ image_id }}"
  flavor_name = "m1.medium"
}
```

The use of `${terraform.workspace}` ensures that the VM's name in openstack links to your terraform workspace. However, it is not mandatory.

**openstack_compute_instance_v2** has a lot of parameters available at [openstack_compute_instance_v2](https://www.terraform.io/docs/providers/openstack/r/compute_instance_v2.html).  We will use a few of them in the workshop.

To test your code and see what would be created, run:

```bash
terraform plan
```

To create the infra, run:

```bash
terraform apply
```

To access our new VM or run a provisioning script, we need to create a key and attach it to the VM. This is done in 2 steps.

1- create an `openstack_compute_keypair_v2` as follow:

```terraform
resource "openstack_compute_keypair_v2" "workshop-worker-keypair" {
  name       = "${terraform.workspace}-workshop-worker-keypair"
  public_key = "${file("${path.module}/id_rsa.pub")}"
}
```

2- attach the `workshop-worker-keypair` resource to your vm as follow:

```terraform
resource "openstack_compute_instance_v2" "workshop_worker" {
  name        = "${terraform.workspace}-workshop_worker"
  image_id    = "{{ image_id }}"
  flavor_name  = "m1.medium"
  key_pair    = openstack_compute_keypair_v2.workshop-worker-keypair.id
  
  network {
    name = var.internal_net_name
  }
}
```

If you look closely at the `keypair` assignation, you will see how it references the resource type `openstack_compute_keypair_v2`, the resource name `workshop-worker-keypair` and the resource property `id`. The `id` is generated by Openstack upon the creation of the keypair.

Dependency resolution is taken care of by Terraform.

Next, we need to attach the VM to the bastion network to access it through the bastion.

- Hint: the network name is **network_1**

[More about Terraform Openstack network](https://www.terraform.io/docs/providers/openstack/r/networking_network_v2.html)

[Next: Openstack Networks](08-Network.md)
